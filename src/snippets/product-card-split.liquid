{%- comment %}

  Product Card
  ------------------------------------------------------------------------------

  Usage:

  {% include 'product-card',
              product: { product } - required
              quick_view: { boolean } - optional, defaults to false
              lazy_load: { boolean } - optional, defaults to false,
              show_swatches: { boolean } - optional, defaults to true
              show_reviews: { boolean } - optional, defaults to false
  %}

{% endcomment -%}

{% comment %} Defaults {% endcomment %}

{% assign card_classes = blank %}

{% if quick_view == blank %}
  {% assign quick_view = false %}
{% endif %}

{% if lazy_load == blank %}
  {% assign lazy_load = false %}
{% endif %}

{% if show_swatches == blank %}
  {% assign show_swatches = true %}
{% endif %}

{% if show_sizes == blank %}
  {% assign show_sizes = false %}
{% endif %}

{% if show_reviews == blank %}
  {% assign show_reviews = false %}
{% endif %}

{% if reverse_card == true %}
  {% assign card_classes = "card--reverse" %}
{% endif %}
{% comment %} End Defaults {% endcomment %}

{% assign alt_swatch_identifier = 'swatch' %} {% comment %} Used to find swatch images attached at the product level.  We don't want to display them in the gallery. {% endcomment %}

{% if product %}

  {% assign product_image_dimension = '600x' %}
  {% assign product_url = product.url %}
  {% if collection %}
    {% assign product_url = product.url | within: collection %}
  {% endif %}

  {% for option in product.options_with_values %}
    {% if option.name == 'Color' %}
      {% assign product_colors = option.values %}

      {% for color in product_colors %}
        {% assign default_variant = blank %}
        {% for variant in product.variants %}
          {% if variant.title contains color %}
            {% assign default_variant = variant %}
          {% endif %}
        {% endfor %}

        {% comment %}Checks for color filtering{% endcomment %}
        {% assign hide_card = false %}
        {% assign color_downcase = color | downcase %}
        {% if current_tags != blank %}
          {% for current_tag in current_tags %}
          {% assign current_tag_downcase = current_tag | downcase  %}
            {% if current_tag_downcase contains 'color' and current_tag_downcase contains color_downcase %}
              {% assign hide_card = false %}
              {% break %}
            {% else %}
              {% assign hide_card = true %}
            {% endif %}
          {% endfor %}
        {% endif %}

        <div class="content-grid__item {% if hide_card %}hide{% endif %}" data-grid-item>
          <div id="product-card-{{product.id}}--{{product-color}}"
          class="product-card {{card_classes}}"
          data-product-card
          >
            <div class="product-card__contents" data-product-card-contents>
              {% if default_variant.image != blank %}
                <div class="product-card__gallery">
                  <a href="{{ default_variant.url | within: collection }}">
                    <div class="product-card__gallery-image" data-product-card-gallery>
                      <img data-src="{{ default_variant.image.src | img_url: product_image_dimension }}" alt="{{ default_variant.image.alt | escape }}" data-product-card-main-lazy>
                      <div class="product-card__gallery-placeholder"></div>
                    </div>
                  </a>

                  {% if show_sizes %}
                    {%- capture sizes_html -%}
                      {% include 'product-dots-sizes'
                        current_color: color %}
                    {%- endcapture -%}

                    {% if sizes_html != blank %}
                      <div class="product-card__sizes-container">
                        <div class="variant-message" data-variant-message>
                          Quick Add to Cart
                        </div>
                        {{ sizes_html }}
                      </div>
                    {% endif %}
                  {% endif %}
                </div>
              {% endif %}
              <div class="product-card__info">
                {% if show_tag %}
                  {% capture tag_html %}
                    {% if product != blank %}
                      {% for tag in product.tags %}
                        {% if tag contains 'Badge:' or tag contains 'badge:' %}
                          <span class="badge">{{ tag | remove: 'Badge:' | remove: 'badge:'}}</span>
                          {% break %}
                        {% endif %}
                      {% endfor %}
                    {% endif %}
                  {% endcapture %}

                  <div class="product-card__badge-row">
                    {% if tag_html != blank %}
                      {{ tag_html }}
                      {% else %}
                      <span class="badge" aria-hidden style="visibility: hidden;">-</span>
                    {% endif %}
                  </div>
                {% endif %}

                <h3 class="product-card__info-title">
                  <a href="{{ product_url }}">{{ product.title }}</a>
                </h3>

                {% if show_colors %}

                  {% capture color_html %}
                    {% include 'product-colors-counter', product: product, current_color: color %}
                  {% endcapture %}

                  {% if color_html != blank %}
                    <div class="product-card__info-color">
                      {{ color_html }}
                    </div>
                  {% endif %}
                {% endif %}

                <div class="product-card__info-price">

                  {% if product.compare_at_price > product.price %}
                    <s>{{ product.compare_at_price | money }}</s>
                    <span class="visually-hidden">{{ 'products.product.regular_price' | t }}</span>
                  {% endif %}

                  {% if product.price_varies %}
                    {%- assign price = product.price | money -%}
                    {{ 'products.product.from_text_html' | t: price: price }}
                  {% else %}
                    {{ product.price | money }}
                  {% endif %}

                  {% unless product.available %}
                    {{ 'products.product.sold_out' | t }}
                  {% endunless %}
                </div>

                {% if show_reviews %}
                  {% comment %} Add your review provider markup here {% endcomment %}
                {% endif %}

              </div>
            </div>
            <script type="application/json" data-product-json>
              {% include 'product-json' %}
            </script>
          </div>
        </div>

      {% endfor %}
    {% endif %}
  {% endfor %}



{% endif %}
