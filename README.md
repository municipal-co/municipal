## Getting Started

- Make sure your node version is set up to 17.9 or newer (if you are using nvm you can run the command `nvm use` to pick from the .nvmrc set up for the project)
- Install all dependencies using `npm install` or `yarn install`
- Create a development theme instance by duplicating the live theme and renaming it Dev \[Initials\], e.g. Dev \[JG\]
- Duplicate `config.yml.sample` to `config.yml` and add your store information and private app credentials:
  - **store:** the Shopify-specific URL for this store/environment (e.g. my-store.myshopify.com)
  - **theme_id:** the unique id for the theme you want to write to when deploying to this store. You can find this information in the URL of the theme's online editor at Shopify [admin/themes](https://shopify.com/admin/themes).
  - **password:** the private password generated by the app Theme Kit Access. It is unique to each developer, so a new password should be generated for each new developer joining the team.

## Development Scripts

All commands run by NPM (Prefixed `npm run`) allow using arguments by adding `--` then the argument to be used e.g. `npm run watch -- --e development`

### NPM Scripts

```bash
npm run watch
```

Starts watching for file changes and once they happen, deploys the updates to the shopify environment required.

### Available Arguments

**`--environment / --e`**: Defines the environmnet data to be used from the config.yml list, defaults to 'development'. If that environment is not present in the config, it fails with an error.

**`--open=false`**: Prevents Browsersync from opening the preview instance.

```bash
npm run build
```

Clears the dist folder and rebuild all the assets, accepts no arguments.

```bash
npm run deploy
```

Clears the dist folder and rebuilds all the assets and starts a complete deploy to Shopify. Theme Kit will only update the files that have been modified.

### Available Arguments

**`--environment / --e`**: Defines the environment data to be used from config.yml list, defaults to 'development'. If the set up environment is not present in the config, it fails with an error.

This argument can be used multiple times to deploy to multiple environments at the same time without rebuilding the assets on each. e.g. `npm run deploy -- --e=developmnet --e=testing` will build all the assets and deploy them to development and testing environments on the config file.

By default, the deploy will follow the same rules of the environment including the `ignore_files` patterns.

**`--mode=full`**: Before deploying, downloads the assets **config/settings_data.json** and **templates/\*.json** (Shopify theme 2.0 config files) from the live theme and deploys the code to the theme(s) defined via the environment argument.

This argument will disregard any ignore pattern on the environment config. Updating the json files mentioned above will also clear out whatever data has been populated on the target theme.

**`--files`**: Can be used to deploy only a selected file/set of files to the selected environment. This can be used as many times as files are needed to be deployed.

Note: Wildcard selectors e.g. `templates/*.json` will not work and if the files selected are covered by any of the ignore patters from the selected environment they will not be deployed and may result in a _file not found_ error.

```bash
npm run eslint
```

Runs the javascript linter and will return a list of warnings/errors based on the severity of the issues found across the project javascript files.

For this project, errors and warnings should be kept as near to zero (0) as possible. However, in the case an error has to be kept, a comment must be present explaining the reasoning behind keeping it as well as an [eslint disabling rule](https://eslint.org/docs/latest/user-guide/configuring/rules#disabling-rules) corresponding to the particular case.

```bash
npm run stylelint
```

Runs a style linter and will return a list of warnings/errors based on the severity of the issues found across the project sass files.

For this project, errors and warnings should always be kept as zero (0). No execeptions of this rule for new files and for legacy files. It's suggested to fix as many errors as possible when updating the files.

## Gulp Tasks

If you have gulp set up globally, you can make use of the individual tasks which can be found on the folder [gulp/tasks](gulp/tasks). They can be run independently to execute a particular piece of the bundle process.

They will also use the arguments listed above in the case they are needed. However, they will not need the extra double dashes `--` before them.

### Task: [Scripts](gulp/tasks/scripts-browserify.js)

```bash
gulp scripts
```

Will rebuild all javascript files starting from the file entries: `theme.js`, `vendor.js`, and `checkout.js` located on the `/_scripts` folder.

### Task: [Icons](gulp/tasks/icons.js)

```bash
gulp icons
```

Will copy over all SVG icons in the folder `/icons`, clear them up (removing xml headers and unneeded information), include the utility classes `.icon` and `.icon-file-name`, then save them as liquid snippets in the `/assets` folder.

Note: All icons are required to be named according to the following naming convention.

- For regular icons: `icon-[icon-name].svg` this will be preprocessed by Shopify to always have black fill, no stroke, and 20px width. This will be used as `{% render 'icon-[icon-name]' %}`.
- For full color icons: `icon-[icon-name]-full-color.svg` this will be processed by Shopify to retain all original colors and strokes and 20px width. This will be used as `{% render 'icon-[icon-name]-full-color' %}`.

### Task: [Styles](gulp/tasks/styles.js)

```bash
gulp styles
```

Will evaluate the styles entrypoints `theme.scss` and `checkout.scss` located in the `/_styles` folder.

### Task: [Files](gulp/tasks/theme-files.js)

```bash
gulp files
```

Will evaluate the content of the folders `/layout`, `/templates`, `/sections`, `/snippets`, `/assets`, `/locales`, `/config` and their subfolders, flatten them, and copy the content to the `/dist` folder.

Note that `/templates` is the only folder allowed to have a single subfolder `/customers`. This folder content will not be flattened so if there's any extra subfolder, Theme Kit will throw an error about trying to push an invalid structure.

##### Additional Documentation

- For [script documentation](src/_scripts/README.md), please see the README file inside `src/_scripts`

### Checkout Additional Scripts

Since additional checkout scripts are saved in a textarea inside the checkout admin settings, they do not have versioning and are liable to be modified or removed at any time. As a precaution, try to store the most up to date version of these scripts inside the snippet `_checkout-additional-scripts.liquid`. This file doesn't get included on the site anywhere but is the only way to keep this content in version control.

## Local Environment Setup

- Using [NVM](https://github.com/nvm-sh/nvm#install--update-script), install Node v17.9.1: `nvm install 17.9.1 && nvm use 17.9.1`
- Install Gulp and Theme Kit globally `npm i --location=global gulp @shopify/themekit`
- Verify your installs using `nvm list`, `gulp -v`, `theme -v`

## Code Editor Setup

- [`.editorconfig`](https://editorconfig.org/#download)
- [Prettier](https://prettier.io/docs/en/editors.html)

### [VS Code](https://code.visualstudio.com/)

_Open your Command Palette, and search for `Show Recommended Extensions`_.

- [EditorConfig for VS Code](https://marketplace.visualstudio.com/items?itemName=EditorConfig.EditorConfig)
- [ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)
- [Stylelint](https://marketplace.visualstudio.com/items?itemName=stylelint.vscode-stylelint)
- [Shopify Liquid](https://marketplace.visualstudio.com/items?itemName=Shopify.theme-check-vscode)
- [Sass](https://marketplace.visualstudio.com/items?itemName=Syler.sass-indented)
- [Non-breaking space highlighter](https://marketplace.visualstudio.com/items?itemName=viktorzetterstrom.non-breaking-space-highlighter)

#### Enable 'Format on Save'

- Open your Command Palette, and search for `Open User Settings (JSON)`, ensure that 'Format on Save' is set to `true`:

```json
"editor.formatOnSave": true,
```

#### Enable sass linting on StyleLint

- Open your Command Palette, and search for `Open User Settings (JSON)`, ensure that 'Stylelint Validate' is set to `["css", "scss"]`:

```json
"stylelint.validate": ["css", "scss"],
```
